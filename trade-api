#!/bin/bash
# Trading Evolution API Server Wrapper
# Runs the FastAPI server inside Docker

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# Check if Docker is available
if ! command -v docker &> /dev/null; then
    echo "Error: Docker is not installed or not in PATH"
    exit 1
fi

# Check if sica_sandbox image exists
if ! docker image inspect sica_sandbox &> /dev/null; then
    echo "Error: sica_sandbox Docker image not found"
    exit 1
fi

echo "üåê Starting Trading Evolution API Server"
echo "   URL: http://localhost:8081"
echo "   Press Ctrl+C to stop"
echo ""

# Run the API server in Docker
docker run --rm \
    --user "$(id -u):$(id -g)" \
    -v "${SCRIPT_DIR}/base_agent:/home/agent/agent_code" \
    -v "${SCRIPT_DIR}/benchmark_data:/home/agent/benchmark_data" \
    -v "${SCRIPT_DIR}/results:/home/agent/results" \
    -v "${SCRIPT_DIR}:/home/agent/project" \
    -w /home/agent/project \
    -e PYTHONPATH="/home/agent/project:/home/agent/agent_code" \
    -p 8081:8081 \
    --network host \
    sica_sandbox \
    python trading_api.py